<!DOCTYPE html>
<html>
<head>
  <title>Company Map</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>
  <div id="map" style="height: 100vh;"></div>
  <script>
    // Escape HTML function to avoid injection
    function escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // Example CSV/JSON data
    const data = [
      {City: "Hyderabad", State: "Telangana", Company: "TMT Rebars", Category: "TMT Rebars", Status: "Intro Session Pending", PoC: "Neha", Latitude: 17.385044, Longitude: 78.486671},
      {City: "Mumbai", State: "Maharashtra", Company: "GreenTech", Category: "Furniture", Status: "Completed", PoC: "Amit", Latitude: 19.0760, Longitude: 72.8777},
      // add all your rows here
    ];

    // Status-based color coding
    const statusColors = {
      "Completed": "green",
      "Working on Documentation": "orange",
      "Inactive": "red",
      "Hold": "grey",
      "Intro Session Pending": "blue",
      "To be updated": "purple",
      "Data Received": "cyan",
      "Certification Payment Pending": "pink"
    };

    // Initialize map
    const map = L.map('map').setView([20.5937, 78.9629], 5); // center on India

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // Add markers
    data.forEach(row => {
      const status = row.Status || "Unknown";
      const color = statusColors[status] || "black";

      const marker = L.circleMarker([row.Latitude, row.Longitude], {
        color: color,
        radius: 8,
        fillOpacity: 0.8
      }).addTo(map);

      marker.bindPopup(
        `<b>${escapeHtml(row.Company)}</b><br>` +
        `${escapeHtml(row.Category)}<br>` +
        `${escapeHtml(row.City)}, ${escapeHtml(row.State)}<br>` +
        `<b>Status:</b> ${escapeHtml(row.Status)}<br>` +
        `<b>PoC:</b> ${escapeHtml(row.PoC)}`
      );
    });
  </script>
</body>
</html>
